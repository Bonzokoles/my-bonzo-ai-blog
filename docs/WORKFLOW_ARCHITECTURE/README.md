# üèóÔ∏è Architektura i Workflow - MyBonzo AI Blog

**Data utworzenia**: 1 listopada 2025  
**Status**: ‚úÖ Production Ready  
**Typ**: Modularna architektura mikroserwis√≥w

---

## üìã Spis Tre≈õci

1. [PrzeglƒÖd Architektury](#przeglƒÖd-architektury)
2. [Mo≈ºliwo≈õci Systemu](#mo≈ºliwo≈õci-systemu)
3. [Workflow Developmentu](#workflow-developmentu)
4. [Przyk≈Çady Implementacji](#przyk≈Çady-implementacji)
5. [Best Practices](#best-practices)
6. [Troubleshooting](#troubleshooting)

---

## üéØ PrzeglƒÖd Architektury

### Aktualna Struktura

```
mybonzoAIblog/
‚îÇ
‚îú‚îÄ‚îÄ src/pages/                          ‚Üê G≈Ç√≥wne strony bloga (Astro)
‚îÇ   ‚îú‚îÄ‚îÄ index.astro                    ‚Üê Homepage
‚îÇ   ‚îú‚îÄ‚îÄ blog/                          ‚Üê Artyku≈Çy
‚îÇ   ‚îú‚îÄ‚îÄ api/                           ‚Üê API endpoints
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ai/                        ‚Üê AI funkcje (bonzo-chat.ts)
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ eksperymenty/                  ‚Üê EKSPERYMENTALNE PROJEKTY
‚îÇ       ‚îú‚îÄ‚îÄ _SZABLON/                  ‚Üê Szablon dla nowych projekt√≥w
‚îÇ       ‚îú‚îÄ‚îÄ projekt-1/
‚îÇ       ‚îú‚îÄ‚îÄ projekt-2/
‚îÇ       ‚îî‚îÄ‚îÄ [nowe-projekty]/
‚îÇ
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îú‚îÄ‚îÄ KONFIG_PODPROJEKT/             ‚Üê Konfiguracje monorepo
‚îÇ   ‚îî‚îÄ‚îÄ [assety]/
‚îÇ
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îî‚îÄ‚îÄ WORKFLOW_ARCHITECTURE/         ‚Üê TA DOKUMENTACJA
‚îÇ
‚îî‚îÄ‚îÄ [config files]
```

### Kluczowe Komponenty

1. **Astro SSR** - G≈Ç√≥wny framework (v5.0+)
2. **Cloudflare Pages** - Hosting dla stron
3. **Cloudflare Workers** - Serverless functions i proxy
4. **Folder `eksperymenty/`** - Miejsce na nowe funkcje
5. **Modularny routing** - Ka≈ºda funkcja mo≈ºe mieƒá w≈ÇasnƒÖ ≈õcie≈ºkƒô

---

## üöÄ Mo≈ºliwo≈õci Systemu

### ‚úÖ CO MO≈ªESZ ZROBIƒÜ?

#### 1. Generator Zdjƒôƒá (AI Image Generator)

**Mo≈ºliwo≈õƒá**: TAK ‚úÖ  
**Gdzie**: `/generator-zdjec` lub `/ai-images`  
**Jak**:

```
eksperymenty/
‚îî‚îÄ‚îÄ generator-zdjec/
    ‚îú‚îÄ‚îÄ main-app/              ‚Üê UI generator (Astro/React)
    ‚îÇ   ‚îú‚îÄ‚îÄ src/pages/
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.astro    ‚Üê Formularz + preview
    ‚îÇ   ‚îî‚îÄ‚îÄ api/
    ‚îÇ       ‚îî‚îÄ‚îÄ generate.ts    ‚Üê Wywo≈Çanie DALL-E/Stable Diffusion
    ‚îú‚îÄ‚îÄ subpage/               ‚Üê Galeria wygenerowanych
    ‚îî‚îÄ‚îÄ worker-proxy/          ‚Üê Routing /generator-zdjec/*
```

**Integracje**:
- OpenAI DALL-E API
- Stability AI (Stable Diffusion)
- Cloudflare AI (Workers AI)
- R2 Storage dla zapisanych obraz√≥w

---

#### 2. Generator Tekstu (AI Content Generator)

**Mo≈ºliwo≈õƒá**: TAK ‚úÖ  
**Gdzie**: `/generator-tekst` lub `/ai-writer`  
**Jak**:

```
eksperymenty/
‚îî‚îÄ‚îÄ generator-tekst/
    ‚îú‚îÄ‚îÄ main-app/
    ‚îÇ   ‚îú‚îÄ‚îÄ src/
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TextEditor.tsx
    ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PromptBuilder.tsx
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pages/
    ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ index.astro
    ‚îÇ   ‚îî‚îÄ‚îÄ api/
    ‚îÇ       ‚îî‚îÄ‚îÄ generate-text.ts  ‚Üê OpenAI/Gemini
    ‚îî‚îÄ‚îÄ worker-proxy/
```

**Mo≈ºliwo≈õci**:
- Blog post generator
- SEO content writer
- Rewriter/paraphraser
- T≈Çumacz z AI
- Podsumowania artyku≈Ç√≥w

---

#### 3. Niezale≈ºny Projekt z GitHub

**Mo≈ºliwo≈õƒá**: TAK ‚úÖ  
**Scenariusz**: Masz gotowy projekt na GitHub, chcesz go wrzuciƒá do bloga

**Workflow**:

```powershell
# 1. Sklonuj projekt
cd Q:\mybonzo\mybonzoAIblog\src\pages\eksperymenty
git clone https://github.com/user/moj-projekt.git

# 2. Dostosuj konfiguracjƒô
cd moj-projekt
# Edytuj astro.config.mjs, wrangler.jsonc (ustaw base path)

# 3. Deploy
npm install
npm run build
npm run deploy  # Cloudflare Pages

# 4. Skonfiguruj routing w g≈Ç√≥wnym proxy
# Dodaj wpis w worker-proxy/index.js:
# { prefix: '/moj-projekt/', target: 'https://moj-projekt.pages.dev' }

# 5. Gotowe!
# https://mybonzo.com/moj-projekt/
```

---

#### 4. Eksperymenty Bez Globalnego Deployu

**Mo≈ºliwo≈õƒá**: TAK ‚úÖ  
**Korzy≈õƒá**: Pracujesz tylko nad jednƒÖ funkcjƒÖ, reszta strony dzia≈Ça normalnie

**Workflow**:

```powershell
# Pracujesz nad nowym AI avatarem
cd eksperymenty/ai-avatar

# Lokalny development
npm run dev  # Test na localhost:4321

# Deploy TYLKO tego eksperymentu
npm run deploy  # Tylko ta funkcja idzie na Cloudflare

# G≈Ç√≥wna strona dzia≈Ça bez zmian!
# Nie musisz rebuildowaƒá ca≈Çego bloga
```

**Zalety**:
- ‚ö° Szybkie iteracje
- üîí Brak konflikt√≥w z produkcjƒÖ
- üß™ Bezpieczne testowanie
- üì¶ Izolacja projektu

---

#### 5. Multiple Generators na Jednej Stronie

**Mo≈ºliwo≈õƒá**: TAK ‚úÖ  
**Przyk≈Çad**: Mega-dashboard z kilkoma generatorami

```
/ai-tools/                        ‚Üê G≈Ç√≥wny hub
‚îú‚îÄ‚îÄ /generator-tekst              ‚Üê Generator 1
‚îú‚îÄ‚îÄ /generator-zdjec              ‚Üê Generator 2
‚îú‚îÄ‚îÄ /tts-generator                ‚Üê Generator 3 (text-to-speech)
‚îú‚îÄ‚îÄ /voice-clone                  ‚Üê Generator 4 (klonowanie g≈Çosu)
‚îî‚îÄ‚îÄ /avatar-generator             ‚Üê Generator 5 (AI avatar)
```

**Struktura**:

```
eksperymenty/
‚îú‚îÄ‚îÄ ai-tools-hub/              ‚Üê Dashboard (g≈Ç√≥wna strona)
‚îÇ   ‚îî‚îÄ‚îÄ src/pages/
‚îÇ       ‚îî‚îÄ‚îÄ index.astro        ‚Üê Lista wszystkich narzƒôdzi
‚îÇ
‚îú‚îÄ‚îÄ generator-tekst/           ‚Üê Ka≈ºdy generator osobno
‚îú‚îÄ‚îÄ generator-zdjec/
‚îú‚îÄ‚îÄ tts-generator/
‚îú‚îÄ‚îÄ voice-clone/
‚îî‚îÄ‚îÄ avatar-generator/
```

---

#### 6. A/B Testing i Feature Flags

**Mo≈ºliwo≈õƒá**: TAK ‚úÖ  
**Jak**: Worker proxy mo≈ºe kierowaƒá u≈ºytkownik√≥w do r√≥≈ºnych wersji

```javascript
// worker-proxy/index.js
const ROUTES = [
    {
        prefix: '/blog/',
        target: Math.random() > 0.5 
            ? 'https://blog-v1.pages.dev'  // 50% u≈ºytkownik√≥w
            : 'https://blog-v2.pages.dev', // 50% u≈ºytkownik√≥w
        name: 'Blog A/B Test'
    }
];
```

---

#### 7. Submodules i Multi-Repo

**Mo≈ºliwo≈õƒá**: TAK ‚úÖ  
**Scenariusz**: Masz projekt w osobnym repo, chcesz go jako submodule

```powershell
# Dodaj jako submodule
git submodule add https://github.com/user/projekt.git src/pages/eksperymenty/projekt

# Update submodule
git submodule update --remote

# Deploy
cd src/pages/eksperymenty/projekt
npm run deploy
```

---

### üîß Mo≈ºliwo≈õci Techniczne

#### Dostƒôpne API i Serwisy

| Serwis | U≈ºycie | Integracja |
|--------|--------|------------|
| **OpenAI API** | GPT-4, DALL-E, Whisper | ‚úÖ Gotowe w `bonzo-chat.ts` |
| **Google Gemini** | Gemini Pro, Vision | ‚úÖ Mo≈ºliwe |
| **Cloudflare AI** | Workers AI (LLama, Stable Diffusion) | ‚úÖ Natywne |
| **Anthropic Claude** | Claude 3 | ‚úÖ Mo≈ºliwe |
| **Stability AI** | Stable Diffusion | ‚úÖ Mo≈ºliwe |
| **ElevenLabs** | Text-to-Speech, Voice Clone | ‚úÖ Mo≈ºliwe |
| **Replicate** | R√≥≈ºne modele AI | ‚úÖ Mo≈ºliwe |

#### Storage i Bazy Danych

| Typ | Cloudflare Service | U≈ºycie |
|-----|-------------------|--------|
| **Key-Value** | KV Namespace | Cache, sessions, user data |
| **Object Storage** | R2 | Obrazy, pliki, media |
| **SQL Database** | D1 | Relacyjne dane |
| **Vector DB** | Vectorize | Embeddings, semantic search |
| **Queue** | Queues | Background jobs |
| **Durable Objects** | Durable Objects | Real-time, websockets |

---

## üéØ Workflow Developmentu

### Workflow 1: Nowa Funkcja od Zera

```powershell
# 1. KOPIUJ SZABLON
cd Q:\mybonzo\mybonzoAIblog\src\pages\eksperymenty
Copy-Item -Recurse "_SZABLON" "nazwa-funkcji"

# 2. KONFIGURUJ
cd nazwa-funkcji
# Zmie≈Ñ nazwy w wrangler.jsonc (3 pliki)
# Ustaw base path w subpage/astro.config.mjs

# 3. DEVELOP LOKALNIE
cd main-app
npm install
npm run dev  # localhost:4321

# 4. IMPLEMENTUJ FUNKCJƒò
# Dodaj kod w src/pages/
# Dodaj API w api/
# Dodaj komponenty w src/components/

# 5. TEST
npm run build
npm run preview

# 6. DEPLOY
npm run deploy  # ‚Üí Cloudflare Pages

# 7. SKONFIGURUJ ROUTING
cd ../worker-proxy
# Edytuj index.js (dodaj routing)
npm run deploy  # ‚Üí Cloudflare Worker

# 8. DODAJ CUSTOM DOMAIN
# Dashboard ‚Üí Workers & Pages ‚Üí Triggers ‚Üí Add Domain

# 9. GOTOWE!
# https://mybonzo.com/nazwa-funkcji/
```

---

### Workflow 2: Przeniesienie Projektu z GitHub

```powershell
# 1. CLONE REPO
cd Q:\mybonzo\mybonzoAIblog\src\pages\eksperymenty
git clone https://github.com/user/projekt.git

# 2. DOSTOSUJ DO ASTRO (je≈õli potrzeba)
cd projekt
# Je≈õli to React/Vue/Svelte:
# - Dodaj astro.config.mjs
# - U≈ºyj @astrojs/react (lub odpowiedni adapter)

# 3. USTAW BASE PATH
# astro.config.mjs ‚Üí base: '/projekt/'

# 4. DODAJ WRANGLER CONFIG
# Skopiuj z _SZABLON/main-app/wrangler.jsonc

# 5. DEPLOY
npm install
npm run build
wrangler pages deploy ./dist --project-name=mybonzo-projekt

# 6. ROUTING
# Dodaj do g≈Ç√≥wnego proxy worker

# 7. COMMIT DO G≈Å√ìWNEGO REPO (opcjonalnie)
cd Q:\mybonzo\mybonzoAIblog
git add src/pages/eksperymenty/projekt
git commit -m "feat: Dodano projekt z GitHub"
git push
```

---

### Workflow 3: Szybki Eksperyment (Test w 5 minut)

```powershell
# 1. KOPIUJ SZABLON
cd Q:\mybonzo\mybonzoAIblog\src\pages\eksperymenty
Copy-Item -Recurse "_SZABLON" "quick-test"

# 2. EDYTUJ TYLKO MAIN-APP
cd quick-test/main-app/src/pages
# Edytuj index.example.astro ‚Üí zmie≈Ñ na index.astro
# Dodaj sw√≥j kod

# 3. LOKALNY TEST
cd ../..
npm install
npm run dev

# 4. Dzia≈Ça? Deploy!
npm run deploy

# 5. DONE! Masz URL: https://mybonzo-exp-quick-test-main.pages.dev
```

---

### Workflow 4: Produkcyjne API Endpoint

```powershell
# Przyk≈Çad: Generator zdjƒôƒá przez API

# 1. Utw√≥rz endpoint
# src/pages/api/ai/generate-image.ts

export async function POST({ request }) {
    const { prompt, model } = await request.json();
    
    // Wywo≈Çaj OpenAI DALL-E
    const response = await fetch('https://api.openai.com/v1/images/generations', {
        method: 'POST',
        headers: {
            'Authorization': `Bearer ${import.meta.env.OPENAI_API_KEY}`,
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            prompt,
            model: model || 'dall-e-3',
            n: 1,
            size: '1024x1024'
        })
    });
    
    const data = await response.json();
    return new Response(JSON.stringify(data), {
        headers: { 'Content-Type': 'application/json' }
    });
}

# 2. U≈ºyj w komponencie
# src/components/ImageGenerator.tsx

async function generateImage(prompt: string) {
    const response = await fetch('/api/ai/generate-image', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ prompt })
    });
    return await response.json();
}
```

---

### Workflow 5: Integracja External Service

**Przyk≈Çad**: Dodanie ElevenLabs (Text-to-Speech)

```typescript
// src/pages/api/ai/text-to-speech.ts

export async function POST({ request }) {
    const { text, voice_id } = await request.json();
    
    const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${voice_id}`, {
        method: 'POST',
        headers: {
            'xi-api-key': import.meta.env.ELEVENLABS_API_KEY,
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            text,
            model_id: 'eleven_monolingual_v1',
            voice_settings: {
                stability: 0.5,
                similarity_boost: 0.75
            }
        })
    });
    
    // Zwr√≥ƒá audio jako stream
    return new Response(response.body, {
        headers: {
            'Content-Type': 'audio/mpeg',
            'Content-Disposition': 'attachment; filename="speech.mp3"'
        }
    });
}
```

---

## üí° Przyk≈Çady Implementacji

### Przyk≈Çad 1: Generator Zdjƒôƒá (Full Stack)

**Struktura**:

```
eksperymenty/generator-zdjec/
‚îú‚îÄ‚îÄ main-app/
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.astro          ‚Üê UI Generator
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ImagePrompt.tsx      ‚Üê Formularz promptu
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ImagePreview.tsx     ‚Üê PodglƒÖd obrazu
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ImageHistory.tsx     ‚Üê Historia generacji
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ generate.ts          ‚Üê Generowanie obrazu
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ save.ts              ‚Üê Zapis do R2
‚îÇ   ‚îú‚îÄ‚îÄ astro.config.mjs
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îî‚îÄ‚îÄ wrangler.jsonc
‚îÇ
‚îú‚îÄ‚îÄ subpage/                          ‚Üê Galeria publiczna
‚îÇ   ‚îî‚îÄ‚îÄ src/pages/
‚îÇ       ‚îú‚îÄ‚îÄ index.astro               ‚Üê Grid galerii
‚îÇ       ‚îî‚îÄ‚îÄ [id].astro                ‚Üê Szczeg√≥≈Çy obrazu
‚îÇ
‚îî‚îÄ‚îÄ worker-proxy/
    ‚îî‚îÄ‚îÄ index.js                      ‚Üê Routing /generator-zdjec/*
```

**Kluczowy kod** (`src/api/generate.ts`):

```typescript
import { Ai } from '@cloudflare/ai';

export async function POST({ request, env }) {
    const { prompt } = await request.json();
    
    // U≈ºyj Cloudflare Workers AI
    const ai = new Ai(env.AI);
    
    const response = await ai.run(
        '@cf/stabilityai/stable-diffusion-xl-base-1.0',
        {
            prompt: prompt,
            num_steps: 20
        }
    );
    
    // Zapisz do R2
    const imageId = crypto.randomUUID();
    await env.R2_BUCKET.put(`images/${imageId}.png`, response);
    
    return new Response(JSON.stringify({
        success: true,
        imageId,
        url: `/api/image/${imageId}`
    }), {
        headers: { 'Content-Type': 'application/json' }
    });
}
```

---

### Przyk≈Çad 2: AI Chat Widget (Osadzalny)

**Cel**: Widget AI chat do osadzenia na ka≈ºdej stronie bloga

**Struktura**:

```
eksperymenty/ai-chat-widget/
‚îî‚îÄ‚îÄ main-app/
    ‚îú‚îÄ‚îÄ src/
    ‚îÇ   ‚îú‚îÄ‚îÄ components/
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ChatWidget.tsx        ‚Üê G≈Ç√≥wny komponent
    ‚îÇ   ‚îî‚îÄ‚îÄ api/
    ‚îÇ       ‚îî‚îÄ‚îÄ chat.ts               ‚Üê Proxy do OpenAI
    ‚îî‚îÄ‚îÄ public/
        ‚îî‚îÄ‚îÄ widget.js                 ‚Üê Standalone JS bundle
```

**Kod widgetu**:

```typescript
// src/components/ChatWidget.tsx
import { useState } from 'react';

export default function ChatWidget() {
    const [messages, setMessages] = useState([]);
    const [input, setInput] = useState('');
    
    const sendMessage = async () => {
        const response = await fetch('/api/ai/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                messages: [...messages, { role: 'user', content: input }]
            })
        });
        
        const data = await response.json();
        setMessages([...messages, 
            { role: 'user', content: input },
            { role: 'assistant', content: data.response }
        ]);
        setInput('');
    };
    
    return (
        <div className="chat-widget">
            <div className="messages">
                {messages.map((msg, i) => (
                    <div key={i} className={msg.role}>
                        {msg.content}
                    </div>
                ))}
            </div>
            <input 
                value={input} 
                onChange={(e) => setInput(e.target.value)}
                onKeyPress={(e) => e.key === 'Enter' && sendMessage()}
            />
        </div>
    );
}
```

**U≈ºycie na dowolnej stronie**:

```astro
---
// src/pages/blog/post.astro
import ChatWidget from '@/components/ChatWidget';
---

<article>
    <h1>Tytu≈Ç Posta</h1>
    <p>Tre≈õƒá...</p>
    
    <!-- AI Chat osadzony -->
    <ChatWidget client:load />
</article>
```

---

### Przyk≈Çad 3: Voice Clone Generator

**Struktura**:

```
eksperymenty/voice-clone/
‚îú‚îÄ‚îÄ main-app/
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.astro           ‚Üê Upload sample + generowanie
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ VoiceUpload.tsx       ‚Üê Upload pr√≥bki g≈Çosu
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ VoicePreview.tsx      ‚Üê Odtwarzacz
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TextToSpeech.tsx      ‚Üê Generowanie z tekstu
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ upload-sample.ts      ‚Üê Upload do R2
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ train-voice.ts        ‚Üê Trening modelu (ElevenLabs)
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ generate-speech.ts    ‚Üê TTS z klonowanym g≈Çosem
‚îÇ   ‚îî‚îÄ‚îÄ wrangler.jsonc                ‚Üê Bindings: R2 + secrets
```

**Integracja z ElevenLabs**:

```typescript
// src/api/train-voice.ts
export async function POST({ request, env }) {
    const formData = await request.formData();
    const audioFile = formData.get('audio');
    const name = formData.get('name');
    
    // Upload do ElevenLabs
    const response = await fetch('https://api.elevenlabs.io/v1/voices/add', {
        method: 'POST',
        headers: {
            'xi-api-key': env.ELEVENLABS_API_KEY
        },
        body: formData
    });
    
    const { voice_id } = await response.json();
    
    // Zapisz voice_id w KV
    await env.KV.put(`voice:${name}`, voice_id);
    
    return new Response(JSON.stringify({ voice_id }));
}
```

---

## üéì Best Practices

### 1. Struktura Projektu

**‚úÖ DO**:
- Jeden folder = jedna funkcja
- U≈ºywaj szablonu `_SZABLON`
- Prefiks `mybonzo-EXP-` dla eksperyment√≥w
- Base path zawsze ze slashami: `/sciezka/`

**‚ùå DON'T**:
- Nie mieszaj wielu funkcji w jednym folderze
- Nie commituj `node_modules/`, `dist/`, `.dev.vars`
- Nie hardcoduj secrets w kodzie
- Nie deployuj bez lokalnych test√≥w

---

### 2. API Keys i Secrets

**ZarzƒÖdzanie sekretami**:

```powershell
# Lokalne (development)
# .dev.vars (NIE commituj!)
OPENAI_API_KEY=sk-...
ELEVENLABS_API_KEY=...

# Produkcja (Cloudflare)
wrangler secret put OPENAI_API_KEY
wrangler secret put ELEVENLABS_API_KEY
```

**U≈ºycie w kodzie**:

```typescript
// Astro API route
export async function POST({ request }) {
    const apiKey = import.meta.env.OPENAI_API_KEY; // ‚úÖ Prawid≈Çowo
    // NIE: const apiKey = 'sk-...' ‚ùå
}
```

---

### 3. Performance i Optymalizacja

**Cache Strategy**:

```typescript
// Worker proxy z cache
export default {
    async fetch(request, env, ctx) {
        const cache = caches.default;
        
        // Sprawd≈∫ cache
        let response = await cache.match(request);
        if (response) return response;
        
        // Proxy request
        response = await proxyRequest(request);
        
        // Cache na 1 godzinƒô
        const cacheResponse = response.clone();
        ctx.waitUntil(cache.put(request, cacheResponse));
        
        return response;
    }
};
```

**Image Optimization**:

```astro
---
// U≈ºyj Astro Image dla optymalizacji
import { Image } from 'astro:assets';
import myImage from '@/assets/image.png';
---

<Image 
    src={myImage} 
    alt="Description"
    width={800}
    height={600}
    format="webp"
    quality={80}
/>
```

---

### 4. Error Handling

**API Error Response**:

```typescript
export async function POST({ request }) {
    try {
        const data = await request.json();
        
        // Walidacja
        if (!data.prompt) {
            return new Response(JSON.stringify({
                error: 'Missing prompt'
            }), { 
                status: 400,
                headers: { 'Content-Type': 'application/json' }
            });
        }
        
        // Wykonaj operacjƒô
        const result = await generateImage(data.prompt);
        
        return new Response(JSON.stringify({ success: true, result }));
        
    } catch (error) {
        console.error('API Error:', error);
        return new Response(JSON.stringify({
            error: 'Internal server error',
            message: error.message
        }), { 
            status: 500,
            headers: { 'Content-Type': 'application/json' }
        });
    }
}
```

---

### 5. Monitoring i Logging

**Worker Logs**:

```powershell
# Real-time logs
wrangler tail mybonzo-EXP-projekt-proxy

# Lub w Dashboard:
# Workers & Pages ‚Üí projekt ‚Üí Logs ‚Üí Real-time Logs
```

**Custom Logging**:

```typescript
// Structured logging
export async function POST({ request, env }) {
    const startTime = Date.now();
    
    try {
        const result = await processRequest(request);
        
        // Log sukcesu
        console.log(JSON.stringify({
            level: 'info',
            action: 'generate_image',
            duration: Date.now() - startTime,
            success: true
        }));
        
        return new Response(JSON.stringify(result));
    } catch (error) {
        // Log b≈Çƒôdu
        console.error(JSON.stringify({
            level: 'error',
            action: 'generate_image',
            duration: Date.now() - startTime,
            error: error.message,
            stack: error.stack
        }));
        
        throw error;
    }
}
```

---

## üîß Troubleshooting

### Problem 1: "Module not found" po deploymencie

**Przyczyna**: Niepoprawna konfiguracja dependencies

**Fix**:
```json
// package.json - upewnij siƒô ≈ºe wszystkie deps sƒÖ w "dependencies", nie "devDependencies"
{
    "dependencies": {
        "astro": "^5.0.0",
        "@astrojs/cloudflare": "^12.0.0",
        "openai": "^4.0.0"  // ‚úÖ Tutaj, nie w devDependencies
    }
}
```

---

### Problem 2: API Keys nie dzia≈ÇajƒÖ na produkcji

**Przyczyna**: Sekrety nie sƒÖ ustawione w Cloudflare

**Fix**:
```powershell
# Ustaw sekrety dla Pages
wrangler pages secret put OPENAI_API_KEY --project-name=mybonzo-projekt

# Lub dla Worker
wrangler secret put OPENAI_API_KEY
```

---

### Problem 3: CORS errors przy wywo≈Çywaniu API

**Przyczyna**: Brak CORS headers

**Fix**:
```typescript
// src/api/endpoint.ts
export async function OPTIONS() {
    return new Response(null, {
        headers: {
            'Access-Control-Allow-Origin': '*',
            'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',
            'Access-Control-Allow-Headers': 'Content-Type'
        }
    });
}

export async function POST({ request }) {
    // Tw√≥j kod...
    
    return new Response(JSON.stringify(result), {
        headers: {
            'Content-Type': 'application/json',
            'Access-Control-Allow-Origin': '*'  // ‚úÖ Dodaj CORS
        }
    });
}
```

---

### Problem 4: Worker przekracza CPU limit (Error 1101)

**Przyczyna**: Za d≈Çugie przetwarzanie w Workerze

**Fix**:
```typescript
// U≈ºyj async/await i streams dla d≈Çugich operacji
export default {
    async fetch(request, env, ctx) {
        // Dla d≈Çugich operacji u≈ºyj ctx.waitUntil()
        const promise = longRunningOperation();
        ctx.waitUntil(promise);  // Nie blokuje response
        
        return new Response('Processing started', { status: 202 });
    }
};
```

---

## üìö Dodatkowe Zasoby

### Dokumentacja Wewnƒôtrzna

- **Szablon eksperyment√≥w**: `src/pages/eksperymenty/_SZABLON/INSTRUKCJA_DLA_NOWEGO_PROJEKTU.md`
- **Quick Reference**: `src/pages/eksperymenty/_SZABLON/QUICK_REFERENCE.md`
- **Troubleshooting**: `public/KONFIG_PODPROJEKT/TROUBLESHOOTING.md`
- **Komendy PowerShell**: `public/KONFIG_PODPROJEKT/TERMINAL_COMMANDS.md`

### Dokumentacja Zewnƒôtrzna

- [Astro Documentation](https://docs.astro.build)
- [Cloudflare Workers Docs](https://developers.cloudflare.com/workers/)
- [Cloudflare Pages Docs](https://developers.cloudflare.com/pages/)
- [Cloudflare AI Docs](https://developers.cloudflare.com/workers-ai/)
- [OpenAI API Reference](https://platform.openai.com/docs/api-reference)
- [ElevenLabs API Docs](https://elevenlabs.io/docs/api-reference)

---

## üéâ Podsumowanie

### Mo≈ºesz robiƒá WSZYSTKO co opisa≈Çe≈õ:

‚úÖ **Generator zdjƒôƒá** ‚Üí W≈Çasna podstrona `/generator-zdjec`  
‚úÖ **Generator tekstu** ‚Üí W≈Çasna podstrona `/ai-writer`  
‚úÖ **Eksperymenty** ‚Üí Folder `eksperymenty/` bez globalnego deployu  
‚úÖ **Projekt z GitHub** ‚Üí Clone ‚Üí dostosuj ‚Üí deploy ‚Üí routing  
‚úÖ **Multiple funkcje** ‚Üí Ka≈ºda na osobnej ≈õcie≈ºce  
‚úÖ **Przenoszenie miƒôdzy repo** ‚Üí Submodules lub direct copy  

### Kluczowe Zalety Architektury:

üöÄ **Modularno≈õƒá** - Ka≈ºda funkcja niezale≈ºna  
‚ö° **Szybki development** - Deploy tylko zmienionej czƒô≈õci  
üîí **Izolacja** - Eksperymenty nie wp≈ÇywajƒÖ na produkcjƒô  
üì¶ **Reu≈ºywalno≈õƒá** - Projekty przeno≈õne miƒôdzy repo  
üåê **Skalowalno≈õƒá** - Dodawaj funkcje bez limit√≥w  
üí∞ **Free tier friendly** - Cloudflare oferuje du≈ºo za darmo  

---

**Data**: 1 listopada 2025  
**Wersja**: 1.0  
**Status**: Production Ready ‚úÖ
